Metasploit Intro:
    * Metasploit is the most commonly used exploitation platform.
        Main components:
        [
            msfconsole: The main command-line interface.
            Modules: supporting modules such as exploits, scanners, payloads, etc.
            Tools: Stand-alone tools that will help vulnerability research, vulnerability assessment, or penetration testing. 
            Some of these tools are msfvenom, pattern_create and pattern_offset.
        ]

    * We will mainly interact with msfconsole. (Desktop shortcut created!)
    
    AGAIN, definitions:
    - An exploit:             [A piece of code that leverages a vulnerability.]
    - Vulnerability:          [A design, logic or coding flaw in a target. Allows for exploitation.]
    - Payload:                [Code that will run on the target system, allowing desired outcome (RCE).]
    

    AUXILIARY:
        * Contains all supporting modules such as scanners, crawlers and fuzzers.
    
    ENCODERS:
        * Allows encoding of payload. ATTEMPT TO GET PAST SIGNATURE-BASED ANTIVIRUS!
        * This is not a direct attempt to evade antivirus.

    ANTIVIRUS EVASION:
        * More concrete ways to evade ANTIVIRUS than encoder.

    EXPLOITS

    NOPs:
        * No OPeration. Literally do nothing. The cpu does nothing for one clock cycle.
        * USED AS A BUFFER TO ACHIEVE CONSISTENT PAYLOAD SIZE.
            [Represented in the Intel x86 CPU family with 0x90]

    PAYLOADS:
        * Codes that run on the target system. Exploits leverage vuln, however need payload to achieve desired result.
        Example:        [Getting shell, loading malware/backdoor, running command or launching app for POC.]
        *** Running command is useful, however, interactive connection allowing commands to be executed is better. SHELL
        SHELL:          [Interactive command line. Metasploit offers ability to open many of these on target.]

        WITHIN PAYLOADS THERE ARE 4 DIRECTORIES:
            * ADAPTERS:     [Wraps a payload to convert to diff formats. E.g Powershell adapter makes a single powershell command to run payload.]
            * Single:       [Self contained payload, no extra components.]
            * Stagers:      [Sets up connection between METASPLOIT and target. Staged payload uploads a stager on target, downloads the stage, (rest of payload). Intial size payload small, then downloads large.]
            * Stages:       [Downloaded by the stager. Allows larger payload.]

        HOW TO IDENTIFY STAGED VS. SINGLE:
            * Both below are reverse shells. 
            "    generic/shell_reverse_tcp          Single, denoted by _
                windows/x64/shell/reverse_tcp       Staged, denoted by nesting (/)
            "

    POST:
        * Useful for post-exploitation. 

    
    MSFCONSOLE:
        Useful commands:
            * Launch msfconsole with  msfconsole.
            * You can use the history command to see commands you have typed earlier.
            * help command can be used on its own or for a specific command
            * clear (to clear the terminal screen)

        *** "MSF CONSOLE IS MANAGED BY CONTEXT! Hence any parameters set within modules are lost if module left!"


        USE COMMAND:
            * use exploit/windows/smb/ms17_010_eternalblue
        
            ...ETERNAL BLUE info:
                [
                    Exploit allegedly developed by the U.S. National Security Agency (N.S.A.) for a vulnerability affecting the SMBv1 server
                    SMB (Server Message Block) used in Windows networks for file sharing and file printing.
                    EternalBlue was leaked by the cybercriminal group "Shadow Brokers" in April 2017. 
                    In May 2017, this vulnerability was exploited worldwide in the WannaCry ransomware attack. 
                ]

            * Console changes, denotes current Use exploit. However, we did not ENTER a folder as typically expected.
            * We should now have a context set up in which we will work. Use show options to examine.
            * This lists parameters/ variables that need to be set and more. 

            ** the "show [module type]" command will list available modules. E.g module type payload, exploit etc.
            ** Example:         [show payloads]

            *** To leave current context, use " back " command.
            ** Use " info " command within a module's context to show further info on the module.
            ** OR use info module path. info exploit/windows/smb/ms17_010_eternalblue
            
        SEARCH:
            * One of the most useful. Searches Metasploit framework DB for modules relevant to parameter.
            * You can conduct searches using CVE numbers, exploit names (eternalblue, heartbleed, etc.), or target system.
            EXAMPLE:    "search ms17-010"

            * We can use any module returned based on the number at the start of the line.
            I.E use 0       if returned results 0 is module required.

            ** RANK is also useful. Shows how the exploit is rated.

            SEARCH CAN BE DIRECTED:
                * Want to find search results related to certain module type?   [search type:auxiliary telnet]
            
    
    WORKING WITH MODULES:
        * Workflow involves entering a context by:[use (MODULE_NAME)]
        * We then need to set parameters. Use [show options]
        * To set parameters:    [set PARAMETER_NAME VALUE]
        Example:    [set rhosts 10.10.165.39]
            [show options] to ensure it was set.

        GLOBAL CHANGE:
        [setg] & [unsetg]       Used to set and unset parameters globally.


        NOTING DIFFERENT POTENTIAL PROMPTS:
            Normal command prompt           [root@ip-10-10-XX-XX:~#]
            MFSCONSOLE                      [msf6 >]
            CONTEXT PROMPT                  [msf6 exploit(windows/smb/ms17_010_eternalblue) >]
            METERPRETER                     [meterpreter >]     (IMPORTANT PAYLOAD. METERPRETER agent loaded on target system and connected back to you).
            TARGET SYS SHELL                [C:\Windows\system32>]

    COMMON PARAMETERS:
        
        RHOSTS:         “Remote host”, the IP address of the target system. A single IP address or a network range can be set. 
                        This will support the CIDR (Classless Inter-Domain Routing) notation (/24, /16, etc.) or a network range (10.10.10.x – 10.10.10.y). 
                        You can also use a file where targets are listed, one target per line using file:/path/of/the/target_file.txt, as you can see below.

        RPORT:          “Remote port”, the port on the target system the vulnerable application is running on.

        PAYLOAD:        The payload you will use with the exploit.

        LHOST:          “Localhost”, the attacking machine (your AttackBox or Kali Linux) IP address.

        LPORT:          “Local port”, the port you will use for the reverse shell to connect back to. 
                        This is a port on your attacking machine, and you can set it to any port not used by any other application.

        SESSION:        Each connection established to the target system using Metasploit will have a session ID. You will use this with post-exploitation modules that will connect to the target system using an existing connection.

    

    LAUNCHING MODULES:
        * Once we have set required parameters, we can launch the module with   [exploit]
        * [exploit -z] command will run the exploit and background the session as soon as it opens.

        ** Before launching, we can use [ check ] to see if the target is vulnerable without actually launching module.
        
        SESSION:
            ** Once a vulnerability is succesfully exploited, a session is created.
            * Communication channel between Metasploit and target.
            * Can use [ background ] or [CTR + Z] to background the session prompt, returning to msfconsole prompt.
            * Use [sessions] to see active sessions.
            * After, to interact with a session use [session -i SESSION_NUMBER]

        ISSUES WITH OPTIONS/PAYLOADS/TARGETS CHANGE:
            [unset PAYLOAD]     [unset TARGET]
        